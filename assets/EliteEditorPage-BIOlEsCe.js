import{j as e}from"./query-vendor-Dt0le05-.js";import{a as s,i as t,f as a}from"./react-vendor-Bs_e_mwx.js";import{b as l}from"./index-3Yd-DfCj.js";import{b as n,c as i}from"./useManuscripts-Badbure7.js";import{A as r,j as c,C as o,y as d,D as x,z as m,w as h,G as p,J as j,K as b,N as u,O as g,Q as w,W as f,Y as y,Z as N,_ as v,$ as k,q as C,a0 as S,a1 as L}from"./ui-vendor-CeVg9BGE.js";import"./chart-vendor-ce8NDi9W.js";import"./index-DH6jIlqu.js";import"./geminiClient--LmOtRoR.js";import"./jszip.min-Daw9fIkx.js";const $=({size:s="md",text:t="جاري التحميل..."})=>e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(c,{className:"animate-spin "+("lg"===s?"w-8 h-8":"w-5 h-5")}),e.jsx("span",{className:"text-sm text-gray-600",children:t})]}),z=({icon:s,title:t,description:a,action:l,actionLabel:n})=>e.jsxs("div",{className:"flex flex-col items-center gap-3 text-center",children:[e.jsx(s,{className:"w-12 h-12 text-gray-400"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg text-gray-900",children:t}),e.jsx("p",{className:"text-sm text-gray-600",children:a})]}),l&&e.jsx("button",{onClick:l,className:"mt-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:n})]}),K=()=>{const{id:K}=t(),B=a(),{success:E,error:M,info:_}=l(),H=s.useRef(null),{data:U,isLoading:q}=n(K),F=i(),[O,R]=s.useState(""),[W,G]=s.useState(""),[J,Q]=s.useState(0),[Y,Z]=s.useState(0),[P,V]=s.useState(!1),[X,ee]=s.useState(null),[se,te]=s.useState(!1),[ae,le]=s.useState(""),[ne,ie]=s.useState(!1),re=function(e,t=500){const[a,l]=s.useState(e);return s.useEffect(()=>{const s=setTimeout(()=>l(e),t);return()=>clearTimeout(s)},[e,t]),a}(O,2e3);s.useEffect(()=>{U&&(G(U.title||""),R(U.content||""))},[U]),s.useEffect(()=>{const e=O.replace(/<[^>]*>/g,"").trim(),s=e?e.split(/\s+/).length:0,t=e.length;Q(s),Z(t)},[O]),s.useEffect(()=>{re&&U&&re!==U.content&&ce(!0)},[re]);const ce=async(e=!1)=>{if(K&&O){V(!0);try{await F.mutateAsync({id:K,data:{title:W,content:O}}),ee(new Date),e||E("تم الحفظ بنجاح")}catch(s){e||M("فشل الحفظ")}finally{V(!1)}}},oe=(e,s=null)=>{document.execCommand(e,!1,s),H.current?.focus()},de=()=>{const e=window.getSelection();return e?.toString()||""},xe=async e=>{const s=de();if(s||"continue"===e){ie(!0);try{let t="";const a=O.replace(/<[^>]*>/g," "),l=s||a;switch(e){case"improve":t=(e=>{const s=e.replace(/\s+/g," ").trim();if(!s)return"";const t=s.charAt(0).toUpperCase()+s.slice(1);return`${t}${/[.!؟…]$/.test(t)?"":"."}`})(l),_("تم تحسين النص");break;case"expand":t=(e=>{const s=e.trim();return s?`${s}\n\nتفصيل إضافي: ${s.split(" ").slice(0,8).join(" ")}...`:""})(l),_("تم توسيع النص");break;case"summarize":t=(e=>{const s=e.replace(/\n+/g," ").split(/[.!؟…]/).map(e=>e.trim()).filter(Boolean);if(0===s.length)return"";const t=s.slice(0,2).join("، ");return`ملخص: ${t}${t.endsWith("...")?"":"..."}`})(l),_("تم تلخيص النص");break;case"continue":t=(e=>{const s=e.split(/\s+/).slice(-12).join(" ");return`${e?"\n\n":""}${s} ...`})(l||W),_("تمت متابعة الكتابة")}t&&document.execCommand("insertText",!1,t)}catch(t){M("فشل الحصول على اقتراح AI")}finally{ie(!1)}}else _("قم بتحديد نص أولاً")};return q?e.jsx("div",{className:"min-h-screen bg-shadow-bg flex items-center justify-center",children:e.jsx($,{size:"lg",text:"جاري تحميل المحرر..."})}):U?e.jsxs("div",{className:"min-h-screen bg-shadow-bg",children:[e.jsx("div",{className:"sticky top-0 z-50 bg-shadow-surface border-b border-shadow-primary/20",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"flex-1 max-w-md",children:e.jsx("input",{type:"text",value:W,onChange:e=>G(e.target.value),placeholder:"عنوان المخطوط...",className:"w-full bg-transparent text-2xl font-bold text-shadow-text border-none outline-none placeholder:text-shadow-text/40"})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center gap-2 text-sm text-shadow-text/60",children:P?e.jsxs(e.Fragment,{children:[e.jsx(c,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{children:"جاري الحفظ..."})]}):X?e.jsxs(e.Fragment,{children:[e.jsx(o,{className:"w-4 h-4 text-green-500"}),e.jsxs("span",{children:["حُفظ ",new Date(X).toLocaleTimeString("ar-SA")]})]}):null}),e.jsxs("button",{onClick:()=>ce(),disabled:P,className:"cyber-button bg-shadow-accent px-4 py-2 rounded hover:shadow-glow transition-all flex items-center gap-2 disabled:opacity-50",children:[e.jsx(d,{className:"w-4 h-4"}),"حفظ"]}),e.jsxs("button",{onClick:()=>B("/export",{state:{manuscript:U}}),className:"cyber-button bg-shadow-primary/20 px-4 py-2 rounded hover:bg-shadow-primary/30 transition-all flex items-center gap-2",children:[e.jsx(x,{className:"w-4 h-4"}),"تصدير"]}),e.jsxs("button",{onClick:()=>te(!se),className:"cyber-button px-4 py-2 rounded transition-all flex items-center gap-2 "+(se?"bg-shadow-accent":"bg-shadow-primary/20 hover:bg-shadow-primary/30"),children:[se?e.jsx(m,{className:"w-4 h-4"}):e.jsx(h,{className:"w-4 h-4"}),se?"تحرير":"معاينة"]})]})]}),!se&&e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-1 border-l border-shadow-primary/20 pl-2",children:[e.jsx(T,{icon:e.jsx(p,{}),onClick:()=>oe("bold"),tooltip:"عريض (Ctrl+B)"}),e.jsx(T,{icon:e.jsx(j,{}),onClick:()=>oe("italic"),tooltip:"مائل (Ctrl+I)"}),e.jsx(T,{icon:e.jsx(b,{}),onClick:()=>oe("underline"),tooltip:"تحته خط"})]}),e.jsxs("div",{className:"flex items-center gap-1 border-l border-shadow-primary/20 pl-2",children:[e.jsx(T,{icon:e.jsx(u,{}),onClick:()=>oe("formatBlock","<h1>"),tooltip:"عنوان 1"}),e.jsx(T,{icon:e.jsx(g,{}),onClick:()=>oe("formatBlock","<h2>"),tooltip:"عنوان 2"})]}),e.jsxs("div",{className:"flex items-center gap-1 border-l border-shadow-primary/20 pl-2",children:[e.jsx(T,{icon:e.jsx(w,{}),onClick:()=>oe("insertUnorderedList"),tooltip:"قائمة نقطية"}),e.jsx(T,{icon:e.jsx(f,{}),onClick:()=>oe("insertOrderedList"),tooltip:"قائمة مرقمة"})]}),e.jsxs("div",{className:"flex items-center gap-1 border-l border-shadow-primary/20 pl-2",children:[e.jsx(T,{icon:e.jsx(y,{}),onClick:()=>oe("justifyRight"),tooltip:"محاذاة لليمين"}),e.jsx(T,{icon:e.jsx(N,{}),onClick:()=>oe("justifyCenter"),tooltip:"توسيط"})]}),e.jsxs("div",{className:"flex items-center gap-1 border-l border-shadow-primary/20 pl-2",children:[e.jsx(T,{icon:e.jsx(v,{}),onClick:()=>oe("undo"),tooltip:"تراجع"}),e.jsx(T,{icon:e.jsx(k,{}),onClick:()=>oe("redo"),tooltip:"إعادة"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(T,{icon:ne?e.jsx(c,{className:"animate-spin"}):e.jsx(C,{}),onClick:()=>xe("improve"),tooltip:"تحسين النص بالذكاء الاصطناعي",accent:!0,disabled:ne}),e.jsx(T,{icon:e.jsx(S,{}),onClick:()=>xe("continue"),tooltip:"استكمال الكتابة بالذكاء الاصطناعي",accent:!0,disabled:ne})]})]})]})}),e.jsx("div",{className:"max-w-7xl mx-auto p-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"lg:col-span-3",children:e.jsx("div",{className:"cyber-card bg-shadow-surface rounded-lg border border-shadow-primary/20 p-6 min-h-[600px]",children:se?e.jsx("div",{className:"prose prose-invert max-w-none text-shadow-text",dangerouslySetInnerHTML:{__html:O}}):e.jsx("div",{ref:H,contentEditable:!0,onInput:e=>R(e.currentTarget.innerHTML),onKeyDown:e=>{(e.ctrlKey||e.metaKey)&&"s"===e.key&&(e.preventDefault(),ce()),(e.ctrlKey||e.metaKey)&&"b"===e.key&&(e.preventDefault(),oe("bold")),(e.ctrlKey||e.metaKey)&&"i"===e.key&&(e.preventDefault(),oe("italic"))},onMouseUp:()=>le(de()),className:"outline-none min-h-[550px] text-shadow-text leading-relaxed",dangerouslySetInnerHTML:{__html:O},dir:"rtl"})})}),e.jsxs("div",{className:"lg:col-span-1 space-y-4",children:[e.jsxs("div",{className:"cyber-card bg-shadow-surface rounded-lg border border-shadow-primary/20 p-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-shadow-text mb-4 flex items-center gap-2",children:[e.jsx(L,{className:"w-5 h-5 text-shadow-accent"}),"الإحصائيات"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(D,{label:"الكلمات",value:J.toLocaleString()}),e.jsx(D,{label:"الأحرف",value:Y.toLocaleString()}),e.jsx(D,{label:"الفقرات",value:O.split("<p>").length-1})]})]}),e.jsxs("div",{className:"cyber-card bg-shadow-surface rounded-lg border border-shadow-primary/20 p-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-shadow-text mb-4 flex items-center gap-2",children:[e.jsx(C,{className:"w-5 h-5 text-shadow-accent"}),"مساعد الكتابة"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{label:"تحسين النص",onClick:()=>xe("improve"),disabled:!ae||ne}),e.jsx(I,{label:"توسيع الفكرة",onClick:()=>xe("expand"),disabled:!ae||ne}),e.jsx(I,{label:"تلخيص",onClick:()=>xe("summarize"),disabled:!ae||ne}),e.jsx(I,{label:"استكمال الكتابة",onClick:()=>xe("continue"),disabled:ne})]}),ae&&e.jsxs("p",{className:"text-xs text-shadow-text/60 mt-3",children:["محدد: ",ae.substring(0,50),ae.length>50?"...":""]})]}),e.jsxs("div",{className:"cyber-card bg-shadow-surface rounded-lg border border-shadow-primary/20 p-4",children:[e.jsx("h3",{className:"text-sm font-bold text-shadow-text mb-3",children:"الاختصارات"}),e.jsxs("div",{className:"space-y-2 text-xs text-shadow-text/60",children:[e.jsx(A,{keys:"Ctrl+S",action:"حفظ"}),e.jsx(A,{keys:"Ctrl+B",action:"عريض"}),e.jsx(A,{keys:"Ctrl+I",action:"مائل"})]})]})]})]})}),e.jsx("div",{className:"fixed inset-0 pointer-events-none opacity-10 cyber-grid -z-10"})]}):e.jsx("div",{className:"min-h-screen bg-shadow-bg flex items-center justify-center p-6",children:e.jsx(z,{icon:r,title:"المخطوط غير موجود",description:"لم نتمكن من العثور على المخطوط المطلوب",action:()=>B("/manuscripts"),actionLabel:"العودة للمخطوطات"})})},T=({icon:s,onClick:t,tooltip:a,accent:l=!1,disabled:n=!1})=>e.jsx("button",{onClick:t,title:a,disabled:n,className:`\n      p-2 rounded transition-all\n      ${l?"hover:bg-shadow-accent/20 text-shadow-accent":"hover:bg-shadow-primary/20 text-shadow-text"}\n      disabled:opacity-50 disabled:cursor-not-allowed\n    `,children:s}),D=({label:s,value:t})=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-shadow-text/60",children:s}),e.jsx("span",{className:"text-lg font-bold text-shadow-text",children:t})]}),I=({label:s,onClick:t,disabled:a})=>e.jsx("button",{onClick:t,disabled:a,className:"w-full cyber-button bg-shadow-accent/10 text-shadow-accent px-3 py-2 rounded text-sm hover:bg-shadow-accent/20 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:s}),A=({keys:s,action:t})=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:t}),e.jsx("kbd",{className:"px-2 py-1 bg-shadow-bg rounded text-xs",children:s})]});export{K as default};
