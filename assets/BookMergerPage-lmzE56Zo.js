import{j as e}from"./query-vendor-Dt0le05-.js";import{f as s,a}from"./react-vendor-Bs_e_mwx.js";import{b as t,L as d}from"./index-3Yd-DfCj.js";import{u as n}from"./useManuscripts-Badbure7.js";import{a2 as o,a3 as l,F as r,a4 as c,a5 as i,a6 as x,q as h,w as m,C as b,s as g,a7 as p,a8 as w,a9 as u,x as j}from"./ui-vendor-CeVg9BGE.js";import"./chart-vendor-ce8NDi9W.js";import"./index-DH6jIlqu.js";import"./geminiClient--LmOtRoR.js";import"./jszip.min-Daw9fIkx.js";const N=()=>{const b=s(),{success:g,error:p,info:w,warning:u}=t(),{data:j,isLoading:N}=n(),[M,S]=a.useState([]),[P,F]=a.useState(""),[L,q]=a.useState("sequential"),[T,B]=a.useState(!1),[R,W]=a.useState(!1),[z,A]=a.useState({addToc:!0,addPageNumbers:!0,addChapterHeaders:!0,unifyFormatting:!0,removeRedundancy:!1,aiEnhancement:!1}),E=()=>{const e=M.map(e=>({...e,content:(e.content||"").trim()}));let s="",a=1;s="interleaved"===L?(e=>{const s=e.map(e=>(e.content||"").split(/\n\s*\n/)),a=Math.max(...s.map(e=>e.length)),t=[];for(let d=0;d<a;d++)e.forEach((e,a)=>{s[a][d]&&t.push(`## ${e.title} - Ø¬Ø²Ø¡ ${d+1}\n${s[a][d].trim()}`)});return t.join("\n\n")})(e):e.map((e,s)=>((e,s)=>{if(!z.addPageNumbers)return s;const t=e.wordCount||(e.content||"").split(/\s+/).filter(Boolean).length,d=Math.max(1,Math.ceil(t/250)),n=`\n\n[Øµ ~${a}-${a+d-1}]`;return a+=d,`${s}${n}`})(e,`# ${e.title||`Ù‚Ø³Ù… ${s+1}`}\n\n${e.content}`)).join("\n\n"),z.unifyFormatting&&(s=s.replace(/[\t ]+\n/g,"\n").replace(/\n{3,}/g,"\n\n").trim());const t=z.addToc?e.map((e,s)=>`${s+1}. ${e.title}`):[],d=s?s.split(/\s+/).filter(Boolean).length:0;return{mergedText:s,toc:t,wordCount:d,estimatedPages:Math.max(1,Math.ceil(d/250))}},H=e=>{M.find(s=>s.id===e.id)?u("Ù‡Ø°Ø§ Ø§Ù„ÙƒØªØ§Ø¨ Ù…Ø¶Ø§Ù Ø¨Ø§Ù„ÙØ¹Ù„"):(S([...M,{id:e.id,title:e.title,content:e.content,wordCount:e.word_count||0,order:M.length+1}]),g(`ØªÙ… Ø¥Ø¶Ø§ÙØ©: ${e.title}`))},D={totalBooks:M.length,totalWords:M.reduce((e,s)=>e+s.wordCount,0),avgWords:M.length>0?Math.round(M.reduce((e,s)=>e+s.wordCount,0)/M.length):0,estimatedPages:Math.ceil(M.reduce((e,s)=>e+s.wordCount,0)/250)};return N?e.jsx("div",{className:"min-h-screen bg-shadow-bg flex items-center justify-center",children:e.jsx(d,{size:"lg",text:"Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„..."})}):e.jsxs("div",{className:"min-h-screen bg-shadow-bg p-6",children:[e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"text-center space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-center gap-3 mb-2",children:[e.jsx(o,{className:"w-10 h-10 text-shadow-accent"}),e.jsx("h1",{className:"text-4xl font-bold text-shadow-text cyber-text",children:"Ø¯Ù…Ø¬ Ø§Ù„ÙƒØªØ¨ ÙˆØ§Ù„Ø³Ù„Ø§Ø³Ù„"})]}),e.jsx("p",{className:"text-shadow-text/60",children:"Ø§Ø¯Ù…Ø¬ Ù…Ø®Ø·ÙˆØ·Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø© ÙÙŠ ÙƒØªØ§Ø¨ ÙˆØ§Ø­Ø¯ Ø£Ùˆ Ø³Ù„Ø³Ù„Ø© Ù…ØªÙƒØ§Ù…Ù„Ø©"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1 space-y-4",children:e.jsxs("div",{className:"cyber-card bg-shadow-surface rounded-lg border border-shadow-primary/20 p-4",children:[e.jsxs("h2",{className:"text-xl font-bold text-shadow-text mb-4 flex items-center gap-2",children:[e.jsx(l,{className:"w-5 h-5 text-shadow-accent"}),"Ø§Ù„Ù…Ø®Ø·ÙˆØ·Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©"]}),e.jsx("div",{className:"space-y-2 max-h-[600px] overflow-y-auto",children:j&&j.length>0?j.filter(e=>"completed"===e.status).map(s=>e.jsx(v,{manuscript:s,onAdd:H,isAdded:M.some(e=>e.id===s.id)},s.id)):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(r,{className:"w-12 h-12 mx-auto text-shadow-text/20 mb-2"}),e.jsx("p",{className:"text-shadow-text/60 text-sm",children:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø®Ø·ÙˆØ·Ø§Øª Ù…ÙƒØªÙ…Ù„Ø©"})]})})]})}),e.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[e.jsxs("div",{className:"cyber-card bg-shadow-surface rounded-lg border border-shadow-primary/20 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-xl font-bold text-shadow-text flex items-center gap-2",children:[e.jsx(c,{className:"w-5 h-5 text-shadow-accent"}),"Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¯Ù…Ø¬"]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("button",{onClick:()=>{const e=[...M].sort(()=>Math.random()-.5);S(e),w("ØªÙ… Ø§Ù„Ø®Ù„Ø· Ø¨Ø´ÙƒÙ„ Ø¹Ø´ÙˆØ§Ø¦ÙŠ")},disabled:M.length<2,className:"cyber-button bg-shadow-primary/20 px-3 py-2 rounded text-sm hover:bg-shadow-primary/30 transition-all disabled:opacity-50 flex items-center gap-2",children:[e.jsx(i,{className:"w-4 h-4"}),"Ø®Ù„Ø·"]})})]}),e.jsx("input",{type:"text",value:P,onChange:e=>F(e.target.value),placeholder:"Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒØªØ§Ø¨ Ø§Ù„Ù…Ø¯Ù…Ø¬...",className:"w-full mb-4 px-4 py-3 bg-shadow-bg border border-shadow-primary/30 rounded-lg text-shadow-text placeholder:text-shadow-text/40 focus:outline-none focus:border-shadow-accent transition-colors text-lg font-bold"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-4",children:[e.jsx(y,{active:"sequential"===L,onClick:()=>q("sequential"),icon:e.jsx(c,{className:"w-4 h-4"}),label:"Ù…ØªØ³Ù„Ø³Ù„"}),e.jsx(y,{active:"interleaved"===L,onClick:()=>q("interleaved"),icon:e.jsx(i,{className:"w-4 h-4"}),label:"Ù…ØªØ¯Ø§Ø®Ù„"}),e.jsx(y,{active:"custom"===L,onClick:()=>q("custom"),icon:e.jsx(x,{className:"w-4 h-4"}),label:"Ù…Ø®ØµØµ"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(C,{checked:z.addToc,onChange:e=>A({...z,addToc:e}),label:"Ø¥Ø¶Ø§ÙØ© ÙÙ‡Ø±Ø³"}),e.jsx(C,{checked:z.addPageNumbers,onChange:e=>A({...z,addPageNumbers:e}),label:"ØªØ±Ù‚ÙŠÙ… Ø§Ù„ØµÙØ­Ø§Øª"}),e.jsx(C,{checked:z.addChapterHeaders,onChange:e=>A({...z,addChapterHeaders:e}),label:"Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„ÙØµÙˆÙ„"}),e.jsx(C,{checked:z.unifyFormatting,onChange:e=>A({...z,unifyFormatting:e}),label:"ØªÙˆØ­ÙŠØ¯ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚"}),e.jsx(C,{checked:z.removeRedundancy,onChange:e=>A({...z,removeRedundancy:e}),label:"Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙƒØ±Ø§Ø±",icon:e.jsx(h,{className:"w-3 h-3"})}),e.jsx(C,{checked:z.aiEnhancement,onChange:e=>A({...z,aiEnhancement:e}),label:"ØªØ­Ø³ÙŠÙ† Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡",icon:e.jsx(h,{className:"w-3 h-3"})})]})]}),e.jsxs("div",{className:"cyber-card bg-shadow-surface rounded-lg border border-shadow-primary/20 p-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-shadow-text mb-4 flex items-center gap-2",children:[e.jsx(o,{className:"w-5 h-5 text-shadow-accent"}),"Ø§Ù„ÙƒØªØ¨ Ø§Ù„Ù…Ø®ØªØ§Ø±Ø© (",M.length,")"]}),0===M.length?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(o,{className:"w-16 h-16 mx-auto text-shadow-text/20 mb-3"}),e.jsx("p",{className:"text-shadow-text/60",children:"Ø§Ø®ØªØ± ÙƒØªØ§Ø¨ÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù„Ù„Ø¨Ø¯Ø¡"})]}):e.jsx("div",{className:"space-y-2 mb-4",children:M.map((s,a)=>e.jsx(f,{book:s,index:a,total:M.length,onRemove:()=>{return e=s.id,S(M.filter(s=>s.id!==e)),void w("ØªÙ… Ø§Ù„Ø¥Ø²Ø§Ù„Ø©");var e},onMoveUp:()=>(e=>{if(0===e)return;const s=[...M];[s[e],s[e-1]]=[s[e-1],s[e]],S(s)})(a),onMoveDown:()=>(e=>{if(e===M.length-1)return;const s=[...M];[s[e],s[e+1]]=[s[e+1],s[e]],S(s)})(a)},s.id))}),M.length>0&&e.jsxs("div",{className:"grid grid-cols-4 gap-3 p-4 bg-shadow-bg rounded-lg",children:[e.jsx(k,{label:"Ø§Ù„ÙƒØªØ¨",value:D.totalBooks}),e.jsx(k,{label:"Ø§Ù„ÙƒÙ„Ù…Ø§Øª",value:D.totalWords.toLocaleString()}),e.jsx(k,{label:"Ù…ØªÙˆØ³Ø·",value:D.avgWords.toLocaleString()}),e.jsx(k,{label:"Ø§Ù„ØµÙØ­Ø§Øª",value:D.estimatedPages})]}),M.length>=2&&e.jsxs("div",{className:"flex gap-3 mt-4",children:[e.jsxs("button",{onClick:()=>{M.length<2?u("Ø§Ø®ØªØ± ÙƒØªØ§Ø¨ÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù„Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©"):B(!0)},className:"flex-1 cyber-button bg-shadow-primary/20 px-4 py-3 rounded-lg hover:bg-shadow-primary/30 transition-all flex items-center justify-center gap-2",children:[e.jsx(m,{className:"w-5 h-5"}),"Ù…Ø¹Ø§ÙŠÙ†Ø©"]}),e.jsx("button",{onClick:async()=>{if(M.length<2)p("ÙŠØ¬Ø¨ Ø§Ø®ØªÙŠØ§Ø± ÙƒØªØ§Ø¨ÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù„Ù„Ø¯Ù…Ø¬");else if(P.trim())if(M.some(e=>!e.content))p("Ø¨Ø¹Ø¶ Ø§Ù„Ù…Ø®Ø·ÙˆØ·Ø§Øª Ù„Ø§ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù…Ø­ØªÙˆÙ‰ Ù‚Ø§Ø¨Ù„ Ù„Ù„Ø¯Ù…Ø¬");else{W(!0);try{const{mergedText:e,toc:s,wordCount:a,estimatedPages:t}=E(),d={title:P,books:M,mode:L,options:z,toc:s,content:e,totalWordCount:a,estimatedPages:t};g("ØªÙ… Ø§Ù„Ø¯Ù…Ø¬ Ø¨Ù†Ø¬Ø§Ø­! ğŸ‰"),w("Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØµØ¯ÙŠØ±"),b("/export",{state:{mergedBook:d}})}catch(e){p("ÙØ´Ù„ Ø§Ù„Ø¯Ù…Ø¬")}finally{W(!1)}}else p("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ù†ÙˆØ§Ù† Ù„Ù„ÙƒØªØ§Ø¨ Ø§Ù„Ù…Ø¯Ù…Ø¬")},disabled:R||!P.trim(),className:"flex-1 cyber-button bg-shadow-accent px-4 py-3 rounded-lg hover:shadow-glow transition-all flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:R?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¯Ù…Ø¬..."]}):e.jsxs(e.Fragment,{children:[e.jsx(o,{className:"w-5 h-5"}),"Ø¯Ù…Ø¬ Ø§Ù„Ø¢Ù†"]})})]})]})]})]}),T&&e.jsx($,{books:M,title:P,mode:L,onClose:()=>B(!1)})]}),e.jsx("div",{className:"fixed inset-0 pointer-events-none opacity-10 cyber-grid -z-10"})]})},v=({manuscript:s,onAdd:a,isAdded:t})=>e.jsx("div",{className:`\n    p-3 rounded-lg border transition-all cursor-pointer\n    ${t?"border-shadow-accent/50 bg-shadow-accent/5 opacity-50":"border-shadow-primary/20 hover:border-shadow-accent hover:bg-shadow-accent/5"}\n  `,children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"text-sm font-bold text-shadow-text truncate",children:s.title}),e.jsxs("p",{className:"text-xs text-shadow-text/60",children:[(s.word_count||0).toLocaleString()," ÙƒÙ„Ù…Ø©"]})]}),e.jsx("button",{onClick:()=>a(s),disabled:t,className:`\n          p-2 rounded transition-all\n          ${t?"bg-shadow-accent/20 text-shadow-accent cursor-not-allowed":"hover:bg-shadow-accent/20 text-shadow-text hover:text-shadow-accent"}\n        `,children:t?e.jsx(b,{className:"w-4 h-4"}):e.jsx(g,{className:"w-4 h-4"})})]})}),f=({book:s,index:a,total:t,onRemove:d,onMoveUp:n,onMoveDown:o})=>e.jsx("div",{className:"cyber-card bg-shadow-bg border border-shadow-primary/20 p-3 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("button",{onClick:n,disabled:0===a,className:"p-1 rounded hover:bg-shadow-primary/20 text-shadow-text disabled:opacity-30 disabled:cursor-not-allowed transition-all",children:e.jsx(p,{className:"w-4 h-4"})}),e.jsx("button",{onClick:o,disabled:a===t-1,className:"p-1 rounded hover:bg-shadow-primary/20 text-shadow-text disabled:opacity-30 disabled:cursor-not-allowed transition-all",children:e.jsx(w,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"text-shadow-text/40",children:e.jsx(u,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("span",{className:"text-xs font-bold text-shadow-accent bg-shadow-accent/10 px-2 py-1 rounded",children:["#",a+1]}),e.jsx("h4",{className:"text-sm font-bold text-shadow-text truncate",children:s.title})]}),e.jsxs("p",{className:"text-xs text-shadow-text/60",children:[s.wordCount.toLocaleString()," ÙƒÙ„Ù…Ø©"]})]}),e.jsx("button",{onClick:d,className:"p-2 rounded hover:bg-red-500/10 text-red-500 transition-all",children:e.jsx(j,{className:"w-4 h-4"})})]})}),y=({active:s,onClick:a,icon:t,label:d})=>e.jsxs("button",{onClick:a,className:`\n      cyber-button px-3 py-2 rounded-lg transition-all flex flex-col items-center gap-1\n      ${s?"bg-shadow-accent text-white":"bg-shadow-bg text-shadow-text hover:bg-shadow-primary/20"}\n    `,children:[t,e.jsx("span",{className:"text-xs",children:d})]}),C=({checked:s,onChange:a,label:t,icon:d})=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer group",children:[e.jsx("input",{type:"checkbox",checked:s,onChange:e=>a(e.target.checked),className:"w-4 h-4 rounded border-shadow-primary/30 bg-shadow-bg text-shadow-accent focus:ring-shadow-accent"}),e.jsxs("span",{className:"text-sm text-shadow-text group-hover:text-shadow-accent transition-colors flex items-center gap-1",children:[t,d]})]}),k=({label:s,value:a})=>e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-shadow-text",children:a}),e.jsx("div",{className:"text-xs text-shadow-text/60",children:s})]}),$=({books:s,title:a,mode:t,onClose:d})=>e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-6 bg-black/80 backdrop-blur-sm",children:e.jsxs("div",{className:"cyber-card bg-shadow-surface rounded-lg border-2 border-shadow-accent max-w-4xl w-full max-h-[80vh] overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-shadow-primary/20 flex items-center justify-between",children:[e.jsxs("h3",{className:"text-2xl font-bold text-shadow-text flex items-center gap-2",children:[e.jsx(m,{className:"w-6 h-6 text-shadow-accent"}),"Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø¯Ù…Ø¬"]}),e.jsx("button",{onClick:d,className:"p-2 rounded hover:bg-shadow-primary/20 text-shadow-text transition-all",children:"âœ•"})]}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-shadow-text mb-2",children:a||"ÙƒØªØ§Ø¨ Ù…Ø¯Ù…Ø¬"}),e.jsxs("p",{className:"text-shadow-text/60",children:["ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ù…Ø¬: ","sequential"===t?"Ù…ØªØ³Ù„Ø³Ù„":"interleaved"===t?"Ù…ØªØ¯Ø§Ø®Ù„":"Ù…Ø®ØµØµ"]})]}),s.map((s,a)=>e.jsxs("div",{className:"cyber-card bg-shadow-bg p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsxs("span",{className:"text-sm font-bold text-shadow-accent",children:["Ø§Ù„ÙØµÙ„ ",a+1]}),e.jsx("h4",{className:"text-lg font-bold text-shadow-text",children:s.title})]}),e.jsxs("p",{className:"text-sm text-shadow-text/60",children:[s.wordCount.toLocaleString()," ÙƒÙ„Ù…Ø©"]})]},s.id))]})}),e.jsx("div",{className:"p-6 border-t border-shadow-primary/20 flex justify-end gap-3",children:e.jsx("button",{onClick:d,className:"cyber-button bg-shadow-primary/20 px-6 py-2 rounded hover:bg-shadow-primary/30 transition-all",children:"Ø¥ØºÙ„Ø§Ù‚"})})]})});export{N as default};
